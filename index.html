<!DOCTYPE html>
<!-- saved from url=(0046)https://www.wjceo.com/examples/demo/cloud.html -->
<html lang="en">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

    <title>Threejs使用canvas更新纹理</title>
    <style type="text/css">
        html,
        body {
            margin: 0;
            height: 100%;
        }

        canvas {
            display: block;
        }

        #surface {
            position: fixed;
            left: 0;
            bottom: 0;
        }
    </style>
    
</head>

<body marginwidth="0" marginheight="0"
    style="background: url(&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAGQCAYAAADPx2I1AAACxElEQVR4Xu3SB1cNcByHcb2RhrQ3yZWmco4dEYkoifYe99at27L33lkhyvb+eBlP5/yf3yt4zuf7S0reO/lvE3hJBiTvi8IT0AEpBuyPsT+QEnxA6oEpdgIDUg9OwxPQAWl8QJydIO2QAbTA4Rn2BzYb0DALTxB8QHpDgp0g/YgBtMDROfYHthjQOA9PEHxARuMCO0HGMQMW4QmOwwGZBjQtsT+QGXxAVtNldoKsEwZcgSc4CQdk8wFX2Qmymw2ABXKar7E/kHPKgOvwBC2hB+S23GAnyD1tAC5wk/2BvDMG3IInaA09IL/1NjtB/lkD7tATwAEF5wy4y/5AQVvoAYVt99gJCtsNuE9PAAcUnTfgAfsDRR2hBxR3PGQnKL5gwCN6AjigpBMPeMxOUNJJB1w04An7A1svGfCUnoAO6IIDtnU9YyfgA7ppge7n8AR0QGkPLLABAl6wP1DaQwf0wgHbe1+yE/ABfbRA3yt4AjqgrB8W2AABr9kfKOunAwbggB0Dy+wEfMAgLTD4Bp6ADogMwQKRobfsBAZEhuEJdg6/Y3+ADxihBUbewxPgAaOwQPnoB3YCA8rH6AnGVtgf2IUHjNMC4x/hCfCACVigYuITO4EBFZOf4QnogEo8IApPUBldZX+AD4jBAlWxL+wEBlRNfYUnoAOq8YDpNXaCagPi8AQ18XX2BwyomfkGT0AH1OIBs9/ZCWoNSNATJH6wP7DbgLmf8ATBB9TN/2InMKBu4Tc8AR1Qb8DiH/YH6oMP2LP0l53AAAUUUEABBRRQQAEFFFBAAQUUUEABBRRQQAEFFFBAAQUUUEABBRRQQAEFFFBAAQUUUEABBRRQQAEFFFBAAQUUUEABBRRQQAEFFFBAAQUUUEABBRRQQAEFFFBAAQUUUEABBRRQQAEFFFBAAQUUUEABBRRQQAEFFFBAAQUUoAX+A/lxo9Ll/oSYAAAAAElFTkSuQmCC&quot;) 0% 0% / 32px 100%;">
    
    <style>
        html {
            font-size: 30px;
        }
        .content {
            position: fixed;
        }
        a{
            color: #ec2020;
            display: block;
        }
        .title{
            color: chartreuse;
        }
    </style>
    <div class="content">
        <h3>示例代码：</h3>
        <a href="https://dslming.github.io/dushi/rouse/">玫瑰</a>
        <br/>

        <h4 class="title">相机控制案例:</h4>
        <a href="https://dslming.github.io/ThreejsLearning/001-textureDemo/">纹理</a>
        <a href="https://dslming.github.io/ThreejsLearning/002-GLTFTexture/">加载GLTF模型</a>
        <a href="https://dslming.github.io/ThreejsLearning/003-cameraDemo/">相机演示</a>
        <a href="https://dslming.github.io/ThreejsLearning/004-Line/">线的旋转</a>
        <a href="https://dslming.github.io/ThreejsLearning/005-Building/">围绕模型旋转</a>
        <br/>
        
        <h4 class="title">Shader案例:</h4>
        <a href="https://dslming.github.io/ThreejsLearning/006-shader/Three.js_Shader_Demo.html">Three.js Shader Demo</a>
        <a href="https://dslming.github.io/ThreejsLearning/006-shader/Three.js_Shader_Diffuse.html">Three.js Shader Diffuse</a>
        <a href="https://dslming.github.io/ThreejsLearning/006-shader/WebGL_Shader_Demo.html">WebGL Shader Demo</a>
        <a href="https://dslming.github.io/ThreejsLearning/006-shader/WebGL_Shader_Diffuse.html">WebGL Shader Diffuse</a>
        <br/>

        <h4 class="title">矩阵转换:</h4>
        <a href="https://dslming.github.io/ThreejsLearning/008-matrixWorld/index.html">matrixWorld</a>
        <br/>

        <h4 class="title">综合案例:</h4>
        <a href="https://dslming.github.io/ThreejsLearning/007-ff91/index.html">ff91</a>
        <br/>
    </div>
    <script src="./static/three(105).js"></script>
    <script id="vs" type="x-shader/x-vertex">
	varying vec2 vUv;
	void main() {
		vUv = uv;
		gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
	}
</script>

    <script id="fs" type="x-shader/x-fragment">
	uniform sampler2D map;
	uniform vec3 fogColor;
	uniform float fogNear;
	uniform float fogFar;
	varying vec2 vUv;

	void main() {
		float depth = gl_FragCoord.z / gl_FragCoord.w;
		float fogFactor = smoothstep( fogNear, fogFar, depth );
		gl_FragColor = texture2D( map, vUv );
		gl_FragColor.w *= pow( gl_FragCoord.z, 20.0 );
		gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );
	}
</script>

    <script>
        var container;
        var camera, scene, renderer;
        var mesh, geometry, material;

        var mouseX = 0, mouseY = 0;
        var start_time = Date.now();

        var windowHalfX = window.innerWidth / 2;
        var windowHalfY = window.innerHeight / 2;


        init();

        function init() {


            container = document.body;

            //背景颜色设置

            var canvas = document.createElement('canvas');
            canvas.width = 32;
            canvas.height = window.innerHeight;

            var context = canvas.getContext('2d');

            var gradient = context.createLinearGradient(0, 0, 0, canvas.height);
            gradient.addColorStop(0, "#1e4877");
            gradient.addColorStop(0.5, "#4584b4");

            context.fillStyle = gradient;
            context.fillRect(0, 0, canvas.width, canvas.height);

            container.style.background = 'url(' + canvas.toDataURL('image/png') + ')';
            container.style.backgroundSize = '32px 100%';

            camera = new THREE.PerspectiveCamera(30, window.innerWidth / window.innerHeight, 1, 3000);
            camera.position.z = 6000;

            scene = new THREE.Scene();

            geometry = new THREE.Geometry();

            var texture = new THREE.TextureLoader().load('./static/cloud.png', animate);
            texture.magFilter = THREE.LinearMipMapLinearFilter;
            texture.minFilter = THREE.LinearMipMapLinearFilter;

            var fog = new THREE.Fog(0x4584b4, - 100, 3000);

            material = new THREE.ShaderMaterial({

                uniforms: {

                    "map": { type: "t", value: texture },
                    "fogColor": { type: "c", value: fog.color },
                    "fogNear": { type: "f", value: fog.near },
                    "fogFar": { type: "f", value: fog.far },

                },
                vertexShader: document.getElementById('vs').textContent,
                fragmentShader: document.getElementById('fs').textContent,
                depthWrite: false,
                depthTest: false,
                transparent: true

            });

            var plane = new THREE.Mesh(new THREE.PlaneGeometry(64, 64));

            for (var i = 0; i < 8000; i++) {

                plane.position.x = Math.random() * 1000 - 500;
                plane.position.y = - Math.random() * Math.random() * 200 - 15;
                plane.position.z = i;
                plane.rotation.z = Math.random() * Math.PI;
                plane.scale.x = plane.scale.y = Math.random() * Math.random() * 1.5 + 0.5;

                plane.updateMatrix();

                geometry.merge(plane.geometry, plane.matrix);

            }

            mesh = new THREE.Mesh(geometry, material);
            scene.add(mesh);

            mesh = new THREE.Mesh(geometry, material);
            mesh.position.z = - 8000;
            scene.add(mesh);

            renderer = new THREE.WebGLRenderer({ antialias: false, alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            container.appendChild(renderer.domElement);

            document.addEventListener('mousemove', onDocumentMouseMove, false);
            window.addEventListener('resize', onWindowResize, false);

        }

        function onDocumentMouseMove(event) {

            mouseX = (event.clientX - windowHalfX) * 0.25;
            mouseY = (event.clientY - windowHalfY) * 0.15;

        }

        function onWindowResize(event) {

            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();

            renderer.setSize(window.innerWidth, window.innerHeight);

        }

        function animate() {

            requestAnimationFrame(animate);

            position = ((Date.now() - start_time) * 0.03) % 8000;

            camera.position.x += (mouseX - camera.position.x) * 0.1;
            camera.position.y += (- mouseY - camera.position.y) * 0.1;
            camera.position.z = - position + 8000;

            console.log(camera.position);

            renderer.render(scene, camera);

        }
    </script>