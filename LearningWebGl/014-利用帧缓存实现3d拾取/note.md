作者: DSLMing
时间: 2019.11.1

> 参考:
> FunWithWebGL2 024 Picking with Framebuffers

### 利用帧缓存实现3D拾取(3D Picking)


#### 1、3D拾取的概念和原理
1) 对每一个三角形在程序运行时附加一个索引
2) 让片段着色器输出每个像素所在三角形的索引值
3) 得到颜色缓冲，但是并不包含颜色值，而是像素所在的图元的索引值
4) 当鼠标点击在窗口上，我们将根据鼠标的点击位置来获得这个索引并将这个三角形渲染成红色
5) 由于有深度测试，所以能够保证当片元之间相互覆盖时也可以得到最顶部的片元的索引（离相机最近的）

#### 2、从相机空间到屏幕坐标
<img src="02.png" />
相机空间中的一个顶点v，经过透视变换后进入了CVV中。这个变换矩阵实际上完成了两个工作:
1) 顶点从3D空间投影到2D的投影平面（Projection Plane）上。
2) 将投影平面上的2D投影点通过线性插值变换到齐次裁剪空间CVV中。
3) 将CVV中的点通过线性插值变换到viewport中。

#### 3、WebGL 引擎渲染流程
[图解WebGL&Three.js工作原理](https://www.cnblogs.com/wanbo/p/6754066.html)

[读一个WebGL引擎的渲染流程](https://www.jianshu.com/p/de0e31608622)

渲染的过程可以大致描述为：
1)更新Scene与Camera的世界坐标变换矩阵【2、4】
2)根据二者的矩阵作用到渲染对象上进行投影变换【6】
3)渲染背景【7】
4)渲染场景【8】
<img src="03.png">

#### 4、渲染管线（图形流水线）
[渲染管线（图形流水线）](https://www.cnblogs.com/hammerc/p/11190470.html)

渲染管线是指将数据从3D场景转换成2D图像，最终在屏幕上显示出来的总过程。
它分为几个阶段:`应用阶段`、`几何阶段`、`光栅阶段`。


#### 参考
[深入探索3D拾取技术](https://blog.csdn.net/popy007/article/details/8477484)


